[TOC]

# 堆

## 定义

1. 堆是一个完全二叉树。

2. 堆中每个节点的值，都大于等于（或小于等于）其左右子节点。

   

## 性质

使用数组实现堆时，下标为i的节点：

- 从下标0开始存储数据

  左子节点下标：2\*i+1，右子节点下标：2\*i+2。

  父节点下标：(i-1)/2。

  建堆时，从n/2 - 1到0，进行自上向下堆化。

- 从下标1开始存储数据

  左子节点下标：2\*i，右子节点下标：2\*i+1。

  父节点下标：i/2。

  建堆时，从n/2到1，进行自上向下堆化。



## 堆化

1. **建堆时**，自上向下堆化。
2. **新增元素时**，向队尾添加元素，自下向上堆化。
3. **删除元素时**，弹出堆顶元素，队尾元素放在堆顶，自上向下堆化。
4. **淘汰堆顶元素时（保持堆中元素个数不变）**，弹出堆顶元素，新元素放在顶堆，自上向下堆化。

### 时间复杂度

插入与删除

一个包含 n 个节点的完全二叉树，树的高度不会超过log2n。堆化的过程是顺着节点所在路径比较交换的，所以堆化的时间复杂度跟树的高度成正比，也就是 O(logn)。插入数据和删除堆顶元素的主要逻辑就是堆化，所以，往堆中插入一个元素和删除堆顶元素的时间复杂度都是 O(logn)。

### 空间复杂度

堆化的过程中，只涉及比较和交换，所以空间复杂度是O(1)。



## 使用场景

### 优先级队列

优先级队列是一种特殊的队列，优先级高的数据先出队，而不再像普通的队列那样，先进先出。实际上，堆就可以看作优先级队列，只是称谓不一样罢了。

- 假设我们有 100 个小文件，每个文件的大小是 100MB，每个文件中存储的都是有序的字符串。我们希望将这些 100 个小文件合并成一个有序的大文件。
- 假设我们有一个定时器，定时器中维护了很多定时任务，每个任务都设定了一个要触发执行的时间点。希望高效触发定时任务。

### 求Top K

<img src="https://github.com/NieGuanglin/docs/blob/main/pics/data-structure/heap/1.topK问题中堆的抽象过程.png">

<img src="/Users/nieguanglin/docs/pics/data-structure/heap/1.topK问题中堆的抽象过程.png" alt="topK问题中堆的抽象过程" style="zoom:100%;" />

- 如何实时地统计业务接口的 99% 响应时间。

### 哈希算法，散列表，堆的综合使用

假设现在我们有一个包含 10 亿个搜索关键词的日志文件，如何快速获取到 Top 10 最热门的搜索关键词呢。
